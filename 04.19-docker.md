#Autor: Fagner Geraldes Braga  
#Data de criação: 14/01/2025  
#Data de atualização: 15/01/2025  
#Versão: 0.02

## Docker API e Docker SDK

### Docker API

```docker
# Lista os arquivos e diretórios dentro de /var/run
ls /var/run

# Mostra a versão do Docker instalada no sistema
docker version

# Faz uma requisição HTTP para o endpoint de versão do Docker usando o socket UNIX
curl --unix-socket /var/run/docker.sock http://localhost/version

# Atualiza a lista de pacotes disponíveis no sistema
sudo apt update

# Instala o pacote jq (utilitário para processar JSON) no sistema
sudo apt-get install jq -y

# Faz a requisição de versão ao Docker e processa a saída JSON com o jq
curl --unix-socket /var/run/docker.sock http://localhost/version | jq .

# Faz uma requisição ao endpoint de informações gerais do Docker e processa o JSON com jq
curl --unix-socket /var/run/docker.sock http://localhost/info | jq .
```

```docker
# Baixa a imagem "nginx:latest" do Docker Hub
curl --unix-socket /var/run/docker.sock -X POST http://localhost/images/create?fromImage=nginx:latest

# Cria um novo container com base na imagem "nginx"
curl --unix-socket /var/run/docker.sock -X POST -d '{"Image":"nginx"}' -H "Content-Type: application/json" http://localhost/containers/create

# Inicia o container especificado pelo ID
curl --unix-socket /var/run/docker.sock -X POST http://localhost/containers/1d4f20a8fcacb4e1294f8c2dbb9925bc560894b2364480e10bd1e524390c5679/start

# Lista os containers em execução
curl --unix-socket /var/run/docker.sock -X GET http://localhost/containers/json

# Lista os containers em execução e formata a saída com `jq`
curl --unix-socket /var/run/docker.sock -X GET http://localhost/containers/json | jq .

# Lista todos os containers (incluindo os parados) e formata a saída com `jq`
curl --unix-socket /var/run/docker.sock -X GET http://localhost/containers/json?all=true | jq .

# Cria um novo container com a imagem "nginx" e mapeia a porta 80 do container para a porta 8080 do host
curl --unix-socket /var/run/docker.sock -X POST -d '{"Image":"nginx","HostConfig": {"PortBindings":{"80/tcp" : [{"HostIp":"0.0.0.0","HostPort": "8080"}]}}}' -H "Content-Type: application/json" http://localhost/containers/create

# Inicia o container criado anteriormente pelo ID
curl --unix-socket /var/run/docker.sock -X POST http://localhost/containers/dde5e383e2b43e22ba2bc4a03f3dd0ab1127f3d260650c240f81e80ae4fa0b28/start

# Lista novamente todos os containers e formata a saída com `jq`
curl --unix-socket /var/run/docker.sock -X GET http://localhost/containers/json?all=true | jq .

# Remove o container especificado pelo ID forçando a exclusão, mesmo que ele esteja em execução
curl --unix-socket /var/run/docker.sock -X DELETE http://localhost/containers/dde5e383e2b43e22ba2bc4a03f3dd0ab1127f3d260650c240f81e80ae4fa0b28?force=true
```

### Docker SDK

```bash
sudo apt update
sudo apt install pipx -y
pipx ensurepath
sudo pipx ensurepath

pipx install virtualenv
```

```docker
cd ~/devops/python/
virtualenv dockerenv
source dockerenv/bin/activate
pip install docker
python3 01.py
docker container ls -a
python3 02.py
python3 03.py
python3 04.py
python3 05.py
python3 06.py
```

```docker

```

### Limpeza

```docker
# Remove todas as containers do Docker, forçando a exclusão.
docker container rm -f $(docker container ls -qa)

# Remove todas as imagens do Docker, forçando a exclusão mesmo se estiverem sendo usadas por containers.
docker image rm -f $(docker image ls -qa)

# Remove imagens não utilizadas para liberar espaço no sistema.
docker image prune

# Remove todos os dados de build do Docker para limpar cache de compilação e outros artefatos.
docker builder prune -a
```